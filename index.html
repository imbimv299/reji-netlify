<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>デモレジシステム</title>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    /* 基本レイアウト */
    body { font-family: "Meiryo", sans-serif; background: #e0e0e0; margin:0; }
    .container { width: 800px; max-width: 100%; margin:20px auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 8px rgba(0,0,0,0.2);}
    .hidden { display:none; }
    .header { background:#004080; color:#fff; padding:10px; font-size:20px; border-radius:6px 6px 0 0; }
    .field { margin:10px 0; }
    input, select, button { font-size:16px; padding:8px; margin-top:5px; width:100%; box-sizing:border-box; }
    table { width:100%; border-collapse:collapse; margin:10px 0;}
    th,td { border:1px solid #ccc; padding:8px; text-align:center;}
    th { background:#f0f0f0; }
    #message { color:red; font-weight:bold; }
    .audio-btn { width:auto;padding:5px 10px;margin-right:5px; }
  </style>
</head>
<body>

<!-- ログイン画面 -->
<div class="container" id="login">
  <div class="header"><span id="lang_login">ログイン</span> / <span id="lang_login_en">Login</span></div>
  <div class="field">
    <label id="lang_userid">ユーザーID / User ID:</label>
    <input type="text" id="userID">
  </div>
  <div class="field">
    <label id="lang_pw">パスワード / Password:</label>
    <input type="password" id="password">
  </div>
  <button onclick="manualLogin()"><span id="lang_btn_login">ログイン</span></button>
  <hr>
  <button onclick="generateBarcode()"><span id="lang_btn_gen">バーコード生成</span></button>
  <svg id="barcodeImage"></svg><button onclick="downloadBarcode()"><span id="lang_savebarcode">画像保存</span></button>
  <hr>
  <input type="file" id="barcodeFile" accept="image/*">
  <button onclick="scanBarcode()"><span id="lang_btn_scan">バーコード読み込み</span></button>
  <p id="loginStatus"></p>
  <p><button onclick="toggleLang()"><span id="lang_btn_toggle">EN/日本語</span></button>
  <button onclick="toggleFullscreen()"><span id="lang_btn_fs">全画面</span></button></p>
</div>

<!-- レジ画面 -->
<div class="container hidden" id="pos">
  <div class="header">Toshiba-Tech POS</div>
  <p><span id="lang_hi">ようこそ</span>, <strong id="currentUser"></strong></p>
  <button class="audio-btn" onclick="playSound(clickSound)"><span id="lang_btn_soundtest">音テスト</span></button>
  <div class="field">
    <label id="lang_selectproduct">商品選択:</label>
    <select id="productSelect"></select>
    <button onclick="addItem()"><span id="lang_btn_add">追加</span></button>
  </div>
  <table id="cartTable">
    <thead><tr><th id="lang_th_name">商品</th><th id="lang_th_price">価格</th><th id="lang_th_qty">数量</th><th id="lang_th_action">操作</th></tr></thead>
    <tbody></tbody>
  </table>
  <p><span id="lang_total">合計:</span> <span id="total">0</span> 円</p>
  <div class="field">
    <label id="lang_payment">支払方法:</label>
    <select id="paymentMethod"><option>現金</option><option>電子マネー</option></select>
    <button onclick="checkout()"><span id="lang_btn_checkout">会計</span></button>
  </div>
  <div class="field">
    <button onclick="showAddProduct()"><span id="lang_btn_newprod">商品追加</span></button>
    <button onclick="exportCSV()"><span id="lang_btn_export">売上CSV</span></button>
    <button onclick="logout()"><span id="lang_btn_logout">ログアウト</span></button>
  </div>
  <p id="message"></p>
  <div id="receiptArea"></div>
</div>

<!-- 商品追加画面 -->
<div class="container hidden" id="addProductForm">
  <div class="header"><span id="lang_hdr_newprod">新しい商品を追加</span></div>
  <div class="field">
    <label id="lang_lab_newname">商品名:</label><input id="newName">
  </div>
  <div class="field">
    <label id="lang_lab_newprice">価格:</label><input id="newPrice" type="number">
  </div>
  <div class="field">
    <label id="lang_lab_newstock">在庫:</label><input id="newStock" type="number">
  </div>
  <button onclick="addNewProduct()"><span id="lang_btn_newadd">追加</span></button>
  <button onclick="hideAddProduct()"><span id="lang_btn_newcancel">キャンセル</span></button>
</div>

<!-- 音声ファイル -->
<audio id="soundPick" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
<audio id="soundClick" src="https://actions.google.com/sounds/v1/buttons/button_09.ogg"></audio>
<audio id="soundCheckout" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>

<script>
// 効果音読み込み
const pickSound = document.getElementById('soundPick');
const clickSound = document.getElementById('soundClick');
const checkoutSound = document.getElementById('soundCheckout');

// 商品・カート・売上管理
let products = [
  { name:"りんご", price:100, stock:10 },
  { name:"牛乳", price:180, stock:8 },
  { name:"パン", price:150, stock:5 }
];
let cart = [], salesLog = [];

// 多言語設定
let lang = 'ja';
function toggleLang(){
  lang = lang==='ja'?'en':'ja'; 
  document.body.querySelectorAll('[id^="lang_"]').forEach(el=>el.style.display = el.id.endsWith('_en')==(lang==='en')?'inline':'none');
}
// 初期言語表示
window.onload = ()=>toggleLang();

// フルスクリーン
function toggleFullscreen(){
  const el = document.documentElement;
  if(!document.fullscreenElement) el.requestFullscreen(); else document.exitFullscreen();
}

// ログイン処理
function manualLogin(){
  const id = userID.value.trim(), pw = password.value;
  if(id && pw){
    currentUser.textContent = id;
    playSound(clickSound);
    showPOS();
  } else alert('ID/PW入力要');
}

// バーコード作成・保存＋読み取り
function generateBarcode(){
  const id = userID.value.trim(), pw=password.value;
  if(!id||!pw) return alert('ID/PW入力要');
  JsBarcode('#barcodeImage', `${id}:${pw}`, { format:'CODE128', width:2, height:60, displayValue:true });
}
function downloadBarcode(){
  const svg = document.getElementById('barcodeImage'), xml=new XMLSerializer().serializeToString(svg);
  const link=document.createElement('a'); link.href='data:image/svg+xml,'+encodeURIComponent(xml);
  link.download='barcode.svg'; link.click();
}
function scanBarcode(){
  const file=barcodeFile.files[0]; if(!file)return alert('画像選択要');
  const rd=new FileReader(); rd.onload=e=>{
    Quagga.decodeSingle({src:e.target.result, numOfWorkers:0, decoder:{readers:['code_128_reader']}},
      r=>{ if(r?.codeResult){
        const [id,pw]=r.codeResult.code.split(':'); userID.value=id; password.value=pw; manualLogin();
      } else alert('認識失敗'); });
  }; rd.readAsDataURL(file);
}

// POS画面表示
function showPOS(){
  login.classList.add('hidden'); pos.classList.remove('hidden');
  updateProductList();
}

// ログアウト
function logout(){ location.reload(); }

// 効果音再生
function playSound(audio){ audio.currentTime=0; audio.play(); }

// 商品リスト更新
function updateProductList(){
  productSelect.innerHTML='';
  products.forEach((p,i)=>{
    const opt=document.createElement('option'); opt.value=i;
    opt.textContent=`${p.name} ¥${p.price} (${p.stock})`;
    productSelect.appendChild(opt);
  });
}

// カートに追加
function addItem(){
  const i=parseInt(productSelect.value), p=products[i];
  if(p.stock<=0){ message.textContent=`${p.name}在庫切れ`; return;}
  p.stock--; const ex=cart.find(c=>c.name===p.name);
  ex?ex.qty++:cart.push({ name:p.name, price:p.price, qty:1 });
  updateCart(); updateProductList(); message.textContent=''; playSound(pickSound);
}

// カート更新表示
function updateCart(){
  const tb=cartTable.querySelector('tbody'); tb.innerHTML='';
  cart.forEach((c,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${c.name}</td><td>${c.price}</td><td>${c.qty}</td><td><button onclick="removeItem(${i})">×</button></td>`;
    tb.appendChild(tr);
  });
  total.textContent=cart.reduce((s,c)=>s+c.price*c.qty,0);
}

// カートから削除
function removeItem(i){
  products.find(p=>p.name===cart[i].name).stock += cart[i].qty;
  cart.splice(i,1); updateCart(); updateProductList(); playSound(clickSound);
}

// 会計処理
function checkout(){
  if(cart.length===0){ alert('カート空') ; return;}
  const method=paymentMethod.value, totalAmt=cart.reduce((s,c)=>s+c.price*c.qty,0);
  salesLog.push({ time:new Date().toISOString(), user:currentUser.textContent, method, total:totalAmt, items:[...cart] });
  const receiptLines=[
    `レシート (${new Date().toLocaleString()} - ${currentUser.textContent})`,
    `支払方法: ${method}`, `合計: ¥${totalAmt}`,
    ...cart.map(c=>`${c.name} x${c.qty} = ¥${c.price*c.qty}`)
  ];
  receiptArea.innerHTML = `<pre>${receiptLines.join('\n')}</pre>`;
  cart=[]; updateCart(); playSound(checkoutSound);
  generatePDF(receiptLines.join('\n'));
}

// PDF生成
async function generatePDF(text){
  const { jsPDF } = window.jspdf;
  const doc=new jsPDF(); doc.setFontSize(12); doc.text(text,10,10);
  doc.save(`receipt_${Date.now()}.pdf`);
}

// CSV出力
function exportCSV(){
  let csv = 'time,user,method,total,items\n';
  salesLog.forEach(r=>csv+=`${r.time},${r.user},${r.method},${r.total},"${r.items.map(i=>i.name+'x'+i.qty).join(';')}"\n`);
  const a=document.createElement('a'); a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);
  a.download='sales_log.csv'; a.click();
}

// 商品追加フォーム
function showAddProduct(){ addProductForm.classList.remove('hidden'); }
function hideAddProduct(){ addProductForm.classList.add('hidden'); }

function addNewProduct(){
  const n=newName.value.trim(), pr=parseInt(newPrice.value), st=parseInt(newStock.value);
  if(!n||isNaN(pr)||isNaN(st)){ alert('入力必須'); return;}
  products.push({name:n,price:pr,stock:st});
  hideAddProduct(); updateProductList(); alert('商品追加完了！');
}
</script>

</body>
</html<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Toshiba-Tech風レジシステム</title>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    /* 基本レイアウト */
    body { font-family: "Meiryo", sans-serif; background: #e0e0e0; margin:0; }
    .container { width: 800px; max-width: 100%; margin:20px auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 8px rgba(0,0,0,0.2);}
    .hidden { display:none; }
    .header { background:#004080; color:#fff; padding:10px; font-size:20px; border-radius:6px 6px 0 0; }
    .field { margin:10px 0; }
    input, select, button { font-size:16px; padding:8px; margin-top:5px; width:100%; box-sizing:border-box; }
    table { width:100%; border-collapse:collapse; margin:10px 0;}
    th,td { border:1px solid #ccc; padding:8px; text-align:center;}
    th { background:#f0f0f0; }
    #message { color:red; font-weight:bold; }
    .audio-btn { width:auto;padding:5px 10px;margin-right:5px; }
  </style>
</head>
<body>

<!-- ログイン画面 -->
<div class="container" id="login">
  <div class="header"><span id="lang_login">ログイン</span> / <span id="lang_login_en">Login</span></div>
  <div class="field">
    <label id="lang_userid">ユーザーID / User ID:</label>
    <input type="text" id="userID">
  </div>
  <div class="field">
    <label id="lang_pw">パスワード / Password:</label>
    <input type="password" id="password">
  </div>
  <button onclick="manualLogin()"><span id="lang_btn_login">ログイン</span></button>
  <hr>
  <button onclick="generateBarcode()"><span id="lang_btn_gen">バーコード生成</span></button>
  <svg id="barcodeImage"></svg><button onclick="downloadBarcode()"><span id="lang_savebarcode">画像保存</span></button>
  <hr>
  <input type="file" id="barcodeFile" accept="image/*">
  <button onclick="scanBarcode()"><span id="lang_btn_scan">バーコード読み込み</span></button>
  <p id="loginStatus"></p>
  <p><button onclick="toggleLang()"><span id="lang_btn_toggle">EN/日本語</span></button>
  <button onclick="toggleFullscreen()"><span id="lang_btn_fs">全画面</span></button></p>
</div>

<!-- レジ画面 -->
<div class="container hidden" id="pos">
  <div class="header">Toshiba-Tech POS</div>
  <p><span id="lang_hi">ようこそ</span>, <strong id="currentUser"></strong></p>
  <button class="audio-btn" onclick="playSound(clickSound)"><span id="lang_btn_soundtest">音テスト</span></button>
  <div class="field">
    <label id="lang_selectproduct">商品選択:</label>
    <select id="productSelect"></select>
    <button onclick="addItem()"><span id="lang_btn_add">追加</span></button>
  </div>
  <table id="cartTable">
    <thead><tr><th id="lang_th_name">商品</th><th id="lang_th_price">価格</th><th id="lang_th_qty">数量</th><th id="lang_th_action">操作</th></tr></thead>
    <tbody></tbody>
  </table>
  <p><span id="lang_total">合計:</span> <span id="total">0</span> 円</p>
  <div class="field">
    <label id="lang_payment">支払方法:</label>
    <select id="paymentMethod"><option>現金</option><option>電子マネー</option></select>
    <button onclick="checkout()"><span id="lang_btn_checkout">会計</span></button>
  </div>
  <div class="field">
    <button onclick="showAddProduct()"><span id="lang_btn_newprod">商品追加</span></button>
    <button onclick="exportCSV()"><span id="lang_btn_export">売上CSV</span></button>
    <button onclick="logout()"><span id="lang_btn_logout">ログアウト</span></button>
  </div>
  <p id="message"></p>
  <div id="receiptArea"></div>
</div>

<!-- 商品追加画面 -->
<div class="container hidden" id="addProductForm">
  <div class="header"><span id="lang_hdr_newprod">新しい商品を追加</span></div>
  <div class="field">
    <label id="lang_lab_newname">商品名:</label><input id="newName">
  </div>
  <div class="field">
    <label id="lang_lab_newprice">価格:</label><input id="newPrice" type="number">
  </div>
  <div class="field">
    <label id="lang_lab_newstock">在庫:</label><input id="newStock" type="number">
  </div>
  <button onclick="addNewProduct()"><span id="lang_btn_newadd">追加</span></button>
  <button onclick="hideAddProduct()"><span id="lang_btn_newcancel">キャンセル</span></button>
</div>

<!-- 音声ファイル -->
<audio id="soundPick" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
<audio id="soundClick" src="https://actions.google.com/sounds/v1/buttons/button_09.ogg"></audio>
<audio id="soundCheckout" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>

<script>
// 効果音読み込み
const pickSound = document.getElementById('soundPick');
const clickSound = document.getElementById('soundClick');
const checkoutSound = document.getElementById('soundCheckout');

// 商品・カート・売上管理
let products = [
  { name:"りんご", price:100, stock:10 },
  { name:"牛乳", price:180, stock:8 },
  { name:"パン", price:150, stock:5 }
];
let cart = [], salesLog = [];

// 多言語設定
let lang = 'ja';
function toggleLang(){
  lang = lang==='ja'?'en':'ja'; 
  document.body.querySelectorAll('[id^="lang_"]').forEach(el=>el.style.display = el.id.endsWith('_en')==(lang==='en')?'inline':'none');
}
// 初期言語表示
window.onload = ()=>toggleLang();

// フルスクリーン
function toggleFullscreen(){
  const el = document.documentElement;
  if(!document.fullscreenElement) el.requestFullscreen(); else document.exitFullscreen();
}

// ログイン処理
function manualLogin(){
  const id = userID.value.trim(), pw = password.value;
  if(id && pw){
    currentUser.textContent = id;
    playSound(clickSound);
    showPOS();
  } else alert('ID/PW入力要');
}

// バーコード作成・保存＋読み取り
function generateBarcode(){
  const id = userID.value.trim(), pw=password.value;
  if(!id||!pw) return alert('ID/PW入力要');
  JsBarcode('#barcodeImage', `${id}:${pw}`, { format:'CODE128', width:2, height:60, displayValue:true });
}
function downloadBarcode(){
  const svg = document.getElementById('barcodeImage'), xml=new XMLSerializer().serializeToString(svg);
  const link=document.createElement('a'); link.href='data:image/svg+xml,'+encodeURIComponent(xml);
  link.download='barcode.svg'; link.click();
}
function scanBarcode(){
  const file=barcodeFile.files[0]; if(!file)return alert('画像選択要');
  const rd=new FileReader(); rd.onload=e=>{
    Quagga.decodeSingle({src:e.target.result, numOfWorkers:0, decoder:{readers:['code_128_reader']}},
      r=>{ if(r?.codeResult){
        const [id,pw]=r.codeResult.code.split(':'); userID.value=id; password.value=pw; manualLogin();
      } else alert('認識失敗'); });
  }; rd.readAsDataURL(file);
}

// POS画面表示
function showPOS(){
  login.classList.add('hidden'); pos.classList.remove('hidden');
  updateProductList();
}

// ログアウト
function logout(){ location.reload(); }

// 効果音再生
function playSound(audio){ audio.currentTime=0; audio.play(); }

// 商品リスト更新
function updateProductList(){
  productSelect.innerHTML='';
  products.forEach((p,i)=>{
    const opt=document.createElement('option'); opt.value=i;
    opt.textContent=`${p.name} ¥${p.price} (${p.stock})`;
    productSelect.appendChild(opt);
  });
}

// カートに追加
function addItem(){
  const i=parseInt(productSelect.value), p=products[i];
  if(p.stock<=0){ message.textContent=`${p.name}在庫切れ`; return;}
  p.stock--; const ex=cart.find(c=>c.name===p.name);
  ex?ex.qty++:cart.push({ name:p.name, price:p.price, qty:1 });
  updateCart(); updateProductList(); message.textContent=''; playSound(pickSound);
}

// カート更新表示
function updateCart(){
  const tb=cartTable.querySelector('tbody'); tb.innerHTML='';
  cart.forEach((c,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${c.name}</td><td>${c.price}</td><td>${c.qty}</td><td><button onclick="removeItem(${i})">×</button></td>`;
    tb.appendChild(tr);
  });
  total.textContent=cart.reduce((s,c)=>s+c.price*c.qty,0);
}

// カートから削除
function removeItem(i){
  products.find(p=>p.name===cart[i].name).stock += cart[i].qty;
  cart.splice(i,1); updateCart(); updateProductList(); playSound(clickSound);
}

// 会計処理
function checkout(){
  if(cart.length===0){ alert('カート空') ; return;}
  const method=paymentMethod.value, totalAmt=cart.reduce((s,c)=>s+c.price*c.qty,0);
  salesLog.push({ time:new Date().toISOString(), user:currentUser.textContent, method, total:totalAmt, items:[...cart] });
  const receiptLines=[
    `レシート (${new Date().toLocaleString()} - ${currentUser.textContent})`,
    `支払方法: ${method}`, `合計: ¥${totalAmt}`,
    ...cart.map(c=>`${c.name} x${c.qty} = ¥${c.price*c.qty}`)
  ];
  receiptArea.innerHTML = `<pre>${receiptLines.join('\n')}</pre>`;
  cart=[]; updateCart(); playSound(checkoutSound);
  generatePDF(receiptLines.join('\n'));
}

// PDF生成
async function generatePDF(text){
  const { jsPDF } = window.jspdf;
  const doc=new jsPDF(); doc.setFontSize(12); doc.text(text,10,10);
  doc.save(`receipt_${Date.now()}.pdf`);
}

// CSV出力
function exportCSV(){
  let csv = 'time,user,method,total,items\n';
  salesLog.forEach(r=>csv+=`${r.time},${r.user},${r.method},${r.total},"${r.items.map(i=>i.name+'x'+i.qty).join(';')}"\n`);
  const a=document.createElement('a'); a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);
  a.download='sales_log.csv'; a.click();
}

// 商品追加フォーム
function showAddProduct(){ addProductForm.classList.remove('hidden'); }
function hideAddProduct(){ addProductForm.classList.add('hidden'); }

function addNewProduct(){
  const n=newName.value.trim(), pr=parseInt(newPrice.value), st=parseInt(newStock.value);
  if(!n||isNaN(pr)||isNaN(st)){ alert('入力必須'); return;}
  products.push({name:n,price:pr,stock:st});
  hideAddProduct(); updateProductList(); alert('商品追加完了！');
}
</script>

</body>
</html>
